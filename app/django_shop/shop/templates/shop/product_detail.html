
{% extends 'shop/base_shop.html' %}
{% load static %}
{% block title %}
  {{ product.title }} - {{ block.super }}
{% endblock %}

{% block content %}
<div class="row">

  {% include 'shop/includes/categories.html' %}
  <!-- /.col-lg-3 -->

  <div class="col-lg-9">

<div class="card mt-4">
          <img class="card-img-top img-fluid" src="{{ product.image.url }}" alt="{{ product.title }}" style="height:300px; width:300px;">
          <div class="card-body">
            <h3 class="card-title">{{ product.title }}</h3>
            <h4>{{ product.price }} ₽</h4>
            <p class="card-text">{{ product.description }}</p>
            <span class="text-warning">{{ product.category }} {{ product.brand }}</span>
            {% if product.title in cart_items %}
              <a href="#" class="add-to-cart" data-slug="{{ product.slug }}"><button class="btn btn-success" disabled>Товар в корзине</button></a>
            {% elif not product.available %}
                <a href="#" class="add-to-cart" data-slug="{{ product.slug }}"><button class="btn btn-warning" disabled>Нет в наличии</button></a>
            {% else %}
              <a href="#" class="add-to-cart" data-slug="{{ product.slug }}"><button class="btn btn-success">В корзину</button></a>
            {% endif %}
          </div>
          <div class="card-footer">
            {% if product.available %}
            <small class="text-success">Есть в наличии</small>
            {% else %}
            <small class="text-warning">Нет в наличии</small>
            {% endif %}
          </div>
        </div>
</div>
</div>
        <!-- /.card -->

        <script src="{% static 'js/vendor/jquery/jquery.min.js' %}"></script>
        <script>
          $(document).ready(function(){
            $(document).on('click', '.add-to-cart', function(e){
              e.preventDefault()
              slug = $(this).attr('data-slug')
              button = $(this).children("button")
              data = {
                slug: slug,
              }
              $.ajax({
                type: "GET",
                url: "{% url 'add_to_cart_url' %}",
                data: data,
                success: function(data){
                  $('#cart-count').html(data.cart_items_count)
                  $(button).prop("disabled", true)
                  $(button).html('Товар в корзине')
                }
              })
            })
          })
        </script>
{% endblock %}
